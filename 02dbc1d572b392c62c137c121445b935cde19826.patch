From 02dbc1d572b392c62c137c121445b935cde19826 Mon Sep 17 00:00:00 2001
From: nil <shas45558@gmail.com>
Date: Sat, 27 Nov 2021 01:11:07 -0500
Subject: [PATCH] Make gpu and cpu like shas-dream 3.8

---
 .../mach/mt6768/mtk_cpufreq_opp_pv_table.h    |  64 +++----
 .../src/mach/mt6768/mtk_cpufreq_opp_table.h   | 179 +++++++++---------
 .../upower_v2/mtk_unified_power_data_mt6768.h |  37 ++--
 .../base/power/mt6768/mtk_gpufreq_core.c      |  31 ++-
 .../base/power/mt6768/mtk_gpufreq_core.h      | 168 ++++++++--------
 5 files changed, 252 insertions(+), 227 deletions(-)

diff --git a/drivers/misc/mediatek/base/power/cpufreq_v1/src/mach/mt6768/mtk_cpufreq_opp_pv_table.h b/drivers/misc/mediatek/base/power/cpufreq_v1/src/mach/mt6768/mtk_cpufreq_opp_pv_table.h
index eb546b28e..a7ea8dcf5 100644
--- a/drivers/misc/mediatek/base/power/cpufreq_v1/src/mach/mt6768/mtk_cpufreq_opp_pv_table.h
+++ b/drivers/misc/mediatek/base/power/cpufreq_v1/src/mach/mt6768/mtk_cpufreq_opp_pv_table.h
@@ -421,42 +421,42 @@ static unsigned int FY_G75Tbl[NR_FREQ * NR_MT_CPU_DVFS][ARRAY_COL_SIZE] = {
 	/* Freq, Vproc, post_div, clk_div */
 
 	/* L */
-	{ 1800, 81, 1, 1 },
-	{ 1625, 69, 2, 1 },
-	{ 1500, 63, 2, 1 },
-	{ 1450, 61, 2, 1 },
-	{ 1375, 57, 2, 1 },
-	{ 1325, 55, 2, 1 },
-	{ 1275, 53, 2, 1 },
-	{ 1175, 48, 2, 1 },
-	{ 1100, 44, 2, 1 },
-	{ 1050, 42, 2, 1 },
-	{ 999, 39, 2, 1 },
-	{ 950, 37, 2, 1 },
-	{ 900, 35, 2, 1 },
-	{ 850, 32, 4, 1 },
-	{ 774, 28, 4, 1 },
-	{ 500, 24, 4, 1 },
+	{ 2300, 81, 1, 1 },
+	{ 2133, 69, 1, 1 },
+	{ 2066, 63, 1, 1 },
+	{ 2000, 61, 1, 1 },
+	{ 1933, 57, 1, 1 },
+	{ 1866, 55, 1, 1 },
+	{ 1800, 53, 1, 1 },
+	{ 1681, 48, 2, 1 },
+	{ 1532, 44, 2, 1 },
+	{ 1473, 42, 2, 1 },
+	{ 1384, 39, 2, 1 },
+	{ 1295, 37, 2, 1 },
+	{ 1176, 35, 2, 1 },
+	{ 1057, 32, 2, 1 },
+	{ 939, 28, 2, 1 },
+	{ 850, 24, 2, 1 },
 
 
 
     /* B */
-	{ 2000, 94, 1, 1 },
-	{ 1950, 92, 1, 1 },
-	{ 1900, 90, 1, 1 },
-	{ 1850, 88, 1, 1 },
-	{ 1800, 85, 1, 1 },
-	{ 1710, 80, 1, 1 },
-	{ 1621, 75, 1, 1 },
-	{ 1532, 69, 2, 1 },
-	{ 1443, 64, 2, 1 },
-	{ 1354, 59, 2, 1 },
-	{ 1295, 55, 2, 1 },
-	{ 1176, 48, 2, 1 },
-	{ 1087, 43, 2, 1 },
-	{ 998, 37, 2, 1 },
-	{ 774, 28, 4, 1 },
-	{ 500, 24, 4, 1 },
+	{ 2500, 94, 1, 1 },
+	{ 2333, 92, 1, 1 },
+	{ 2166, 90, 1, 1 },
+	{ 2000, 88, 1, 1 },
+	{ 1933, 85, 1, 1 },
+	{ 1866, 80, 1, 1 },
+	{ 1800, 75, 1, 1 },
+	{ 1681, 69, 2, 1 },
+	{ 1532, 64, 2, 1 },
+	{ 1473, 59, 2, 1 },
+	{ 1384, 55, 2, 1 },
+	{ 1295, 48, 2, 1 },
+	{ 1176, 43, 2, 1 },
+	{ 1057, 37, 2, 1 },
+	{ 939, 32, 2, 1 },
+	{ 850, 28, 2, 1 },
 
 
 	/* CCI */
diff --git a/drivers/misc/mediatek/base/power/cpufreq_v1/src/mach/mt6768/mtk_cpufreq_opp_table.h b/drivers/misc/mediatek/base/power/cpufreq_v1/src/mach/mt6768/mtk_cpufreq_opp_table.h
index 7976c7302..d3e427891 100644
--- a/drivers/misc/mediatek/base/power/cpufreq_v1/src/mach/mt6768/mtk_cpufreq_opp_table.h
+++ b/drivers/misc/mediatek/base/power/cpufreq_v1/src/mach/mt6768/mtk_cpufreq_opp_table.h
@@ -670,41 +670,40 @@
 
 /* G75 */
 /* for DVFS OPP table L */
-#define CPU_DVFS_FREQ0_LL_G75		2100000		/* KHz */
-#define CPU_DVFS_FREQ1_LL_G75		1800000		/* KHz */
-#define CPU_DVFS_FREQ2_LL_G75		1625000		/* KHz */
-#define CPU_DVFS_FREQ3_LL_G75		1450000		/* KHz */
-#define CPU_DVFS_FREQ4_LL_G75		1375000		/* KHz */
-#define CPU_DVFS_FREQ5_LL_G75		1325000		/* KHz */
-#define CPU_DVFS_FREQ6_LL_G75		1275000		/* KHz */
-#define CPU_DVFS_FREQ7_LL_G75		1175000		/* KHz */
-#define CPU_DVFS_FREQ8_LL_G75		1100000		/* KHz */
-#define CPU_DVFS_FREQ9_LL_G75		1050000		/* KHz */
-#define CPU_DVFS_FREQ10_LL_G75		999000		/* KHz */
-#define CPU_DVFS_FREQ11_LL_G75		950000		/* KHz */
-#define CPU_DVFS_FREQ12_LL_G75		900000		/* KHz */
-#define CPU_DVFS_FREQ13_LL_G75		850000		/* KHz */
-#define CPU_DVFS_FREQ14_LL_G75		774000		/* KHz */
-#define CPU_DVFS_FREQ15_LL_G75		500000		/* KHz */
+#define CPU_DVFS_FREQ0_LL_G75		2300000		/* KHz */
+#define CPU_DVFS_FREQ1_LL_G75		2133000		/* KHz */
+#define CPU_DVFS_FREQ2_LL_G75		2066000		/* KHz */
+#define CPU_DVFS_FREQ3_LL_G75		2000000		/* KHz */
+#define CPU_DVFS_FREQ4_LL_G75		1933000		/* KHz */
+#define CPU_DVFS_FREQ5_LL_G75		1866000		/* KHz */
+#define CPU_DVFS_FREQ6_LL_G75		1800000		/* KHz */
+#define CPU_DVFS_FREQ7_LL_G75		1681000		/* KHz */
+#define CPU_DVFS_FREQ8_LL_G75		1532000		/* KHz */
+#define CPU_DVFS_FREQ9_LL_G75		1473000		/* KHz */
+#define CPU_DVFS_FREQ10_LL_G75		1384000		/* KHz */
+#define CPU_DVFS_FREQ11_LL_G75		1295000		/* KHz */
+#define CPU_DVFS_FREQ12_LL_G75		1176000		/* KHz */
+#define CPU_DVFS_FREQ13_LL_G75		1057000		/* KHz */
+#define CPU_DVFS_FREQ14_LL_G75		939000		/* KHz */
+#define CPU_DVFS_FREQ15_LL_G75		850000		/* KHz */
 
 /* for DVFS OPP table B */
-#define CPU_DVFS_FREQ0_L_G75		2300000		/* KHz */
-#define CPU_DVFS_FREQ1_L_G75		2100000		/* KHz */
-#define CPU_DVFS_FREQ2_L_G75		1900000		/* KHz */
-#define CPU_DVFS_FREQ3_L_G75		1850000		/* KHz */
-#define CPU_DVFS_FREQ4_L_G75		1800000		/* KHz */
-#define CPU_DVFS_FREQ5_L_G75		1710000		/* KHz */
-#define CPU_DVFS_FREQ6_L_G75		1621000		/* KHz */
-#define CPU_DVFS_FREQ7_L_G75		1532000		/* KHz */
-#define CPU_DVFS_FREQ8_L_G75		1443000		/* KHz */
-#define CPU_DVFS_FREQ9_L_G75		1354000		/* KHz */
-#define CPU_DVFS_FREQ10_L_G75		1295000		/* KHz */
-#define CPU_DVFS_FREQ11_L_G75		1176000		/* KHz */
-#define CPU_DVFS_FREQ12_L_G75		1087000		/* KHz */
-#define CPU_DVFS_FREQ13_L_G75		850000		/* KHz */
-#define CPU_DVFS_FREQ14_L_G75		774000		/* KHz */
-#define CPU_DVFS_FREQ15_L_G75		500000		/* KHz */
-
+#define CPU_DVFS_FREQ0_L_G75		2500000		/* KHz */
+#define CPU_DVFS_FREQ1_L_G75		2333000		/* KHz */
+#define CPU_DVFS_FREQ2_L_G75		2166000		/* KHz */
+#define CPU_DVFS_FREQ3_L_G75		2000000		/* KHz */
+#define CPU_DVFS_FREQ4_L_G75		1933000		/* KHz */
+#define CPU_DVFS_FREQ5_L_G75		1866000		/* KHz */
+#define CPU_DVFS_FREQ6_L_G75		1800000		/* KHz */
+#define CPU_DVFS_FREQ7_L_G75		1681000		/* KHz */
+#define CPU_DVFS_FREQ8_L_G75		1532000		/* KHz */
+#define CPU_DVFS_FREQ9_L_G75		1473000		/* KHz */
+#define CPU_DVFS_FREQ10_L_G75		1384000		/* KHz */
+#define CPU_DVFS_FREQ11_L_G75		1295000		/* KHz */
+#define CPU_DVFS_FREQ12_L_G75		1176000		/* KHz */
+#define CPU_DVFS_FREQ13_L_G75		1057000		/* KHz */
+#define CPU_DVFS_FREQ14_L_G75		939000		/* KHz */
+#define CPU_DVFS_FREQ15_L_G75		850000		/* KHz */
 /* for DVFS OPP table CCI */
 #define CPU_DVFS_FREQ0_CCI_G75		1277000		/* KHz */
 #define CPU_DVFS_FREQ1_CCI_G75		1120000		/* KHz */
@@ -724,58 +723,58 @@
 #define CPU_DVFS_FREQ15_CCI_G75	        500000		/* KHz */
 
 /* for DVFS OPP table L */
-#define CPU_DVFS_VOLT0_VPROC1_G75	100625		/* 10uV */
-#define CPU_DVFS_VOLT1_VPROC1_G75	 93125		/* 10uV */
-#define CPU_DVFS_VOLT2_VPROC1_G75	 89375		/* 10uV */
-#define CPU_DVFS_VOLT3_VPROC1_G75	 85125		/* 10uV */
-#define CPU_DVFS_VOLT4_VPROC1_G75	 82625		/* 10uV */
-#define CPU_DVFS_VOLT5_VPROC1_G75	 81375		/* 10uV */
-#define CPU_DVFS_VOLT6_VPROC1_G75	 80125		/* 10uV */
-#define CPU_DVFS_VOLT7_VPROC1_G75	 77000		/* 10uV */
-#define CPU_DVFS_VOLT8_VPROC1_G75	 74500		/* 10uV */
-#define CPU_DVFS_VOLT9_VPROC1_G75	 73250		/* 10uV */
-#define CPU_DVFS_VOLT10_VPROC1_G75	 71375		/* 10uV */
-#define CPU_DVFS_VOLT11_VPROC1_G75	 70125		/* 10uV */
-#define CPU_DVFS_VOLT12_VPROC1_G75	 68875		/* 10uV */
-#define CPU_DVFS_VOLT13_VPROC1_G75	 67000		/* 10uV */
-#define CPU_DVFS_VOLT14_VPROC1_G75	 64500		/* 10uV */
-#define CPU_DVFS_VOLT15_VPROC1_G75	 62000		/* 10uV */
-
+#define CPU_DVFS_VOLT0_VPROC1_G75	103625		/* 10uV */
+#define CPU_DVFS_VOLT1_VPROC1_G75	 96125		/* 10uV */
+#define CPU_DVFS_VOLT2_VPROC1_G75	 92375		/* 10uV */
+#define CPU_DVFS_VOLT3_VPROC1_G75	 91125		/* 10uV */
+#define CPU_DVFS_VOLT4_VPROC1_G75	 88625		/* 10uV */
+#define CPU_DVFS_VOLT5_VPROC1_G75	 84375		/* 10uV */
+#define CPU_DVFS_VOLT6_VPROC1_G75	 83125		/* 10uV */
+#define CPU_DVFS_VOLT7_VPROC1_G75	 80000		/* 10uV */
+#define CPU_DVFS_VOLT8_VPROC1_G75	 77500		/* 10uV */
+#define CPU_DVFS_VOLT9_VPROC1_G75	 76250		/* 10uV */
+#define CPU_DVFS_VOLT10_VPROC1_G75	 74375		/* 10uV */
+#define CPU_DVFS_VOLT11_VPROC1_G75	 73125		/* 10uV */
+#define CPU_DVFS_VOLT12_VPROC1_G75	 71875		/* 10uV */
+#define CPU_DVFS_VOLT13_VPROC1_G75	 70000		/* 10uV */
+#define CPU_DVFS_VOLT14_VPROC1_G75	 67500		/* 10uV */
+#define CPU_DVFS_VOLT15_VPROC1_G75	 65000		/* 10uV */
 
 /* for DVFS OPP table B */
-#define CPU_DVFS_VOLT0_VPROC2_G75	108750		/* 10uV */
-#define CPU_DVFS_VOLT1_VPROC2_G75	107500		/* 10uV */
-#define CPU_DVFS_VOLT2_VPROC2_G75	106250		/* 10uV */
-#define CPU_DVFS_VOLT3_VPROC2_G75	102000		/* 10uV */
-#define CPU_DVFS_VOLT4_VPROC2_G75	100125		/* 10uV */
-#define CPU_DVFS_VOLT5_VPROC2_G75	 97000		/* 10uV */
-#define CPU_DVFS_VOLT6_VPROC2_G75	 93875		/* 10uV */
-#define CPU_DVFS_VOLT7_VPROC2_G75	 90125		/* 10uV */
-#define CPU_DVFS_VOLT8_VPROC2_G75	 87000		/* 10uV */
-#define CPU_DVFS_VOLT9_VPROC2_G75	 83875		/* 10uV */
-#define CPU_DVFS_VOLT10_VPROC2_G75	 81375		/* 10uV */
-#define CPU_DVFS_VOLT11_VPROC2_G75	 77000		/* 10uV */
-#define CPU_DVFS_VOLT12_VPROC2_G75	 73875		/* 10uV */
-#define CPU_DVFS_VOLT13_VPROC2_G75	 70125		/* 10uV */
-#define CPU_DVFS_VOLT14_VPROC2_G75	 67000		/* 10uV */
-#define CPU_DVFS_VOLT15_VPROC2_G75	 64500		/* 10uV */
+#define CPU_DVFS_VOLT0_VPROC2_G75	109750		/* 10uV */
+#define CPU_DVFS_VOLT1_VPROC2_G75	108500		/* 10uV */
+#define CPU_DVFS_VOLT2_VPROC2_G75	107250		/* 10uV */
+#define CPU_DVFS_VOLT3_VPROC2_G75	106000		/* 10uV */
+#define CPU_DVFS_VOLT4_VPROC2_G75	105125		/* 10uV */
+#define CPU_DVFS_VOLT5_VPROC2_G75	100000		/* 10uV */
+#define CPU_DVFS_VOLT6_VPROC2_G75	 96875		/* 10uV */
+#define CPU_DVFS_VOLT7_VPROC2_G75	 93125		/* 10uV */
+#define CPU_DVFS_VOLT8_VPROC2_G75	 90000		/* 10uV */
+#define CPU_DVFS_VOLT9_VPROC2_G75	 86875		/* 10uV */
+#define CPU_DVFS_VOLT10_VPROC2_G75	 84375		/* 10uV */
+#define CPU_DVFS_VOLT11_VPROC2_G75	 80000		/* 10uV */
+#define CPU_DVFS_VOLT12_VPROC2_G75	 76875		/* 10uV */
+#define CPU_DVFS_VOLT13_VPROC2_G75	 73125		/* 10uV */
+#define CPU_DVFS_VOLT14_VPROC2_G75	 70000		/* 10uV */
+#define CPU_DVFS_VOLT15_VPROC2_G75	 67500		/* 10uV */
+
 /* for DVFS OPP table CCI */
-#define CPU_DVFS_VOLT0_VPROC3_G75	 97625		/* 10uV */
-#define CPU_DVFS_VOLT1_VPROC3_G75	 87000		/* 10uV */
-#define CPU_DVFS_VOLT2_VPROC3_G75	 84500		/* 10uV */
-#define CPU_DVFS_VOLT3_VPROC3_G75	 83250		/* 10uV */
-#define CPU_DVFS_VOLT4_VPROC3_G75	 80750		/* 10uV */
-#define CPU_DVFS_VOLT5_VPROC3_G75	 78875		/* 10uV */
-#define CPU_DVFS_VOLT6_VPROC3_G75	 77000		/* 10uV */
-#define CPU_DVFS_VOLT7_VPROC3_G75	 75125		/* 10uV */
-#define CPU_DVFS_VOLT8_VPROC3_G75	 73250		/* 10uV */
-#define CPU_DVFS_VOLT9_VPROC3_G75	 72000		/* 10uV */
-#define CPU_DVFS_VOLT10_VPROC3_G75	 70125		/* 10uV */
-#define CPU_DVFS_VOLT11_VPROC3_G75	 68875		/* 10uV */
-#define CPU_DVFS_VOLT12_VPROC3_G75	 67625		/* 10uV */
-#define CPU_DVFS_VOLT13_VPROC3_G75	 66375		/* 10uV */
-#define CPU_DVFS_VOLT14_VPROC3_G75	 64500		/* 10uV */
-#define CPU_DVFS_VOLT15_VPROC3_G75	 62000		/* 10uV */
+#define CPU_DVFS_VOLT0_VPROC3_G75	100625		/* 10uV */
+#define CPU_DVFS_VOLT1_VPROC3_G75	 90000		/* 10uV */
+#define CPU_DVFS_VOLT2_VPROC3_G75	 87500		/* 10uV */
+#define CPU_DVFS_VOLT3_VPROC3_G75	 86250		/* 10uV */
+#define CPU_DVFS_VOLT4_VPROC3_G75	 83750		/* 10uV */
+#define CPU_DVFS_VOLT5_VPROC3_G75	 81875		/* 10uV */
+#define CPU_DVFS_VOLT6_VPROC3_G75	 80000		/* 10uV */
+#define CPU_DVFS_VOLT7_VPROC3_G75	 78125		/* 10uV */
+#define CPU_DVFS_VOLT8_VPROC3_G75	 76250		/* 10uV */
+#define CPU_DVFS_VOLT9_VPROC3_G75	 75000		/* 10uV */
+#define CPU_DVFS_VOLT10_VPROC3_G75	 73125		/* 10uV */
+#define CPU_DVFS_VOLT11_VPROC3_G75	 71875		/* 10uV */
+#define CPU_DVFS_VOLT12_VPROC3_G75	 70625		/* 10uV */
+#define CPU_DVFS_VOLT13_VPROC3_G75	 69375		/* 10uV */
+#define CPU_DVFS_VOLT14_VPROC3_G75	 67500		/* 10uV */
+#define CPU_DVFS_VOLT15_VPROC3_G75	 65000		/* 10uV */
 
 /* DVFS OPP table */
 #define OPP_TBL(cluster, seg, lv, vol)	\
@@ -1084,6 +1083,12 @@ static struct mt_cpu_freq_method opp_tbl_method_CCI_PRO[] = {
 static struct mt_cpu_freq_method opp_tbl_method_LL_G75[] = {
 	/* POS,	CLK */
 	FP(1,	1),
+	FP(1,	1),
+	FP(1,	1),
+	FP(1,	1),
+	FP(1,	1),
+	FP(1,	1),
+	FP(1,	1),
 	FP(2,	1),
 	FP(2,	1),
 	FP(2,	1),
@@ -1093,12 +1098,6 @@ static struct mt_cpu_freq_method opp_tbl_method_LL_G75[] = {
 	FP(2,	1),
 	FP(2,	1),
 	FP(2,	1),
-	FP(2,	1),
-	FP(2,	1),
-	FP(2,	1),
-	FP(4,	1),
-	FP(4,	1),
-	FP(4,	1),
 };
 
 static struct mt_cpu_freq_method opp_tbl_method_L_G75[] = {
@@ -1117,8 +1116,8 @@ static struct mt_cpu_freq_method opp_tbl_method_L_G75[] = {
 	FP(2,	1),
 	FP(2,	1),
 	FP(2,	1),
-	FP(4,	1),
-	FP(4,	1),
+	FP(2,	1),
+	FP(2,	1),
 };
 
 static struct mt_cpu_freq_method opp_tbl_method_CCI_G75[] = {
diff --git a/drivers/misc/mediatek/base/power/include/upower_v2/mtk_unified_power_data_mt6768.h b/drivers/misc/mediatek/base/power/include/upower_v2/mtk_unified_power_data_mt6768.h
index c5637984a..692df185b 100644
--- a/drivers/misc/mediatek/base/power/include/upower_v2/mtk_unified_power_data_mt6768.h
+++ b/drivers/misc/mediatek/base/power/include/upower_v2/mtk_unified_power_data_mt6768.h
@@ -1494,15 +1494,15 @@ struct upower_tbl upower_tbl_l_G75 = {
 			.lkg_pwr = {57673, 57673, 57673, 57673, 57673, 57673} },
 		{.cap = 399, .volt = 84375, .dyn_pwr = 75230,
 			.lkg_pwr = {59005, 59005, 59005, 59005, 59005, 59005} },
-		{.cap = 412, .volt = 85625, .dyn_pwr = 80399,
+		{.cap = 412, .volt = 88625, .dyn_pwr = 80399,
 			.lkg_pwr = {60337, 60337, 60337, 60337, 60337, 60337} },
-		{.cap = 431, .volt = 88125, .dyn_pwr = 89808,
+		{.cap = 431, .volt = 91125, .dyn_pwr = 89808,
 			.lkg_pwr = {63002, 63002, 63002, 63002, 63002, 63002} },
-		{.cap = 443, .volt = 89375, .dyn_pwr = 95559,
+		{.cap = 443, .volt = 92375, .dyn_pwr = 95559,
 			.lkg_pwr = {64334, 64334, 64334, 64334, 64334, 64334} },
-		{.cap = 476, .volt = 93125, .dyn_pwr = 112391,
+		{.cap = 476, .volt = 96125, .dyn_pwr = 112391,
 			.lkg_pwr = {68826, 68826, 68826, 68826, 68826, 68826} },
-		{.cap = 516, .volt = 100625, .dyn_pwr = 145356,
+		{.cap = 516, .volt = 103625, .dyn_pwr = 145356,
 			.lkg_pwr = {78350, 78350, 78350, 78350, 78350, 78350} },
 	},
 	.lkg_idx = DEFAULT_LKG_IDX,
@@ -1542,15 +1542,15 @@ struct upower_tbl upower_tbl_cluster_l_G75 = {
 			.lkg_pwr = {0, 0, 0, 0, 0, 0} },
 		{.cap = 399, .volt = 84375, .dyn_pwr = 0,
 			.lkg_pwr = {0, 0, 0, 0, 0, 0} },
-		{.cap = 412, .volt = 85625, .dyn_pwr = 0,
+		{.cap = 412, .volt = 88625, .dyn_pwr = 0,
 			.lkg_pwr = {0, 0, 0, 0, 0, 0} },
-		{.cap = 431, .volt = 88125, .dyn_pwr = 0,
+		{.cap = 431, .volt = 91125, .dyn_pwr = 0,
 			.lkg_pwr = {0, 0, 0, 0, 0, 0} },
-		{.cap = 443, .volt = 89375, .dyn_pwr = 0,
+		{.cap = 443, .volt = 92375, .dyn_pwr = 0,
 			.lkg_pwr = {0, 0, 0, 0, 0, 0} },
-		{.cap = 476, .volt = 93125, .dyn_pwr = 0,
+		{.cap = 476, .volt = 96125, .dyn_pwr = 0,
 			.lkg_pwr = {0, 0, 0, 0, 0, 0} },
-		{.cap = 516, .volt = 100625, .dyn_pwr = 0,
+		{.cap = 516, .volt = 103625, .dyn_pwr = 0,
 			.lkg_pwr = {0, 0, 0, 0, 0, 0} },
 	},
 	.lkg_idx = DEFAULT_LKG_IDX,
@@ -1590,15 +1590,15 @@ struct upower_tbl upower_tbl_b_G75 = {
 		.lkg_pwr = {191620, 191620, 191620, 191620, 191620, 191620} },
 		{.cap = 905, .volt = 100000, .dyn_pwr = 466190,
 		.lkg_pwr = {201447, 201447, 201447, 201447, 201447, 201447} },
-		{.cap = 941, .volt = 103125, .dyn_pwr = 518413,
+		{.cap = 941, .volt = 105125, .dyn_pwr = 518413,
 		.lkg_pwr = {213105, 213105, 213105, 213105, 213105, 213105} },
-		{.cap = 963, .volt = 105000, .dyn_pwr = 550314,
+		{.cap = 963, .volt = 106000, .dyn_pwr = 550314,
 		.lkg_pwr = {220099, 220099, 220099, 220099, 220099, 220099} },
-		{.cap = 984, .volt = 106250, .dyn_pwr = 576569,
+		{.cap = 984, .volt = 107250, .dyn_pwr = 576569,
 		.lkg_pwr = {224762, 224762, 224762, 224762, 224762, 224762} },
-		{.cap = 1004, .volt = 107500, .dyn_pwr = 603482,
+		{.cap = 1004, .volt = 108500, .dyn_pwr = 603482,
 		.lkg_pwr = {229425, 229425, 229425, 229425, 229425, 229425} },
-		{.cap = 1024, .volt = 108750, .dyn_pwr = 631057,
+		{.cap = 1024, .volt = 109750, .dyn_pwr = 631057,
 		.lkg_pwr = {234089, 234089, 234089, 234089, 234089, 234089} },
 	},
 	.lkg_idx = DEFAULT_LKG_IDX,
@@ -1642,11 +1642,11 @@ struct upower_tbl upower_tbl_cluster_b_G75 = {
 			.lkg_pwr = {0, 0, 0, 0, 0, 0} },
 		{.cap = 963, .volt = 105000, .dyn_pwr = 0,
 			.lkg_pwr = {0, 0, 0, 0, 0, 0} },
-		{.cap = 984, .volt = 106250, .dyn_pwr = 0,
+		{.cap = 984, .volt = 107250, .dyn_pwr = 0,
 			.lkg_pwr = {0, 0, 0, 0, 0, 0} },
-		{.cap = 1004, .volt = 107500, .dyn_pwr = 0,
+		{.cap = 1004, .volt = 108500, .dyn_pwr = 0,
 			.lkg_pwr = {0, 0, 0, 0, 0, 0} },
-		{.cap = 1024, .volt = 108750, .dyn_pwr = 0,
+		{.cap = 1024, .volt = 109750, .dyn_pwr = 0,
 			.lkg_pwr = {0, 0, 0, 0, 0, 0} },
 	},
 	.lkg_idx = DEFAULT_LKG_IDX,
@@ -1714,4 +1714,3 @@ struct upower_tbl upower_tbl_cci_G75 = {
 #endif /* UNIFIED_POWER_DATA_H */
 
 
-
diff --git a/drivers/misc/mediatek/base/power/mt6768/mtk_gpufreq_core.c b/drivers/misc/mediatek/base/power/mt6768/mtk_gpufreq_core.c
index f6cf5136e..c6bb6f315 100644
--- a/drivers/misc/mediatek/base/power/mt6768/mtk_gpufreq_core.c
+++ b/drivers/misc/mediatek/base/power/mt6768/mtk_gpufreq_core.c
@@ -134,7 +134,9 @@ static unsigned int g_ptpod_opp_idx_table_segment[] = {
 	0, 2, 4, 6,
 	8, 10, 12, 14,
 	16, 18, 20, 23,
-	25, 27, 29, 31
+	25, 27, 29, 31,
+	32, 33, 34, 35,
+	36, 37, 38, 39
 };
 
 static struct g_opp_table_info g_opp_table_segment[] = {
@@ -170,6 +172,14 @@ GPUOP(SEG_GPU_DVFS_FREQ28, SEG_GPU_DVFS_VOLT28, SEG_GPU_DVFS_VSRAM11),
 GPUOP(SEG_GPU_DVFS_FREQ29, SEG_GPU_DVFS_VOLT29, SEG_GPU_DVFS_VSRAM11),
 GPUOP(SEG_GPU_DVFS_FREQ30, SEG_GPU_DVFS_VOLT30, SEG_GPU_DVFS_VSRAM11),
 GPUOP(SEG_GPU_DVFS_FREQ31, SEG_GPU_DVFS_VOLT31, SEG_GPU_DVFS_VSRAM11),
+GPUOP(SEG_GPU_DVFS_FREQ32, SEG_GPU_DVFS_VOLT32, SEG_GPU_DVFS_VSRAM11),
+GPUOP(SEG_GPU_DVFS_FREQ33, SEG_GPU_DVFS_VOLT33, SEG_GPU_DVFS_VSRAM11),
+GPUOP(SEG_GPU_DVFS_FREQ34, SEG_GPU_DVFS_VOLT34, SEG_GPU_DVFS_VSRAM11),
+GPUOP(SEG_GPU_DVFS_FREQ35, SEG_GPU_DVFS_VOLT35, SEG_GPU_DVFS_VSRAM11),
+GPUOP(SEG_GPU_DVFS_FREQ36, SEG_GPU_DVFS_VOLT36, SEG_GPU_DVFS_VSRAM12),
+GPUOP(SEG_GPU_DVFS_FREQ37, SEG_GPU_DVFS_VOLT37, SEG_GPU_DVFS_VSRAM12),
+GPUOP(SEG_GPU_DVFS_FREQ38, SEG_GPU_DVFS_VOLT38, SEG_GPU_DVFS_VSRAM12),
+GPUOP(SEG_GPU_DVFS_FREQ39, SEG_GPU_DVFS_VOLT39, SEG_GPU_DVFS_VSRAM12),
 };
 
 static const struct of_device_id g_gpufreq_of_match[] = {
@@ -271,12 +281,6 @@ struct mt_gpufreq_power_table_info *pass_gpu_table_to_eara(void)
 	return g_power_table;
 }
 
-/* API : get immediate gpu temperature */
-int mt_gpufreq_get_immed_gpu_temp(void)
-{
-	return get_immediate_gpu_wrap();
-}
-
 /*
  * API : handle frequency change request
  * @Input : is_real_idx
@@ -789,6 +793,12 @@ unsigned int mt_gpufreq_get_min_power(void)
 	: g_power_table[g_segment_min_opp_idx].gpufreq_power;
 }
 
+/* API : get immediate gpu temperature */
+int mt_gpufreq_get_immed_gpu_temp(void)
+{
+	return get_immediate_gpu_wrap();
+}
+
 /* API : get static leakage power */
 unsigned int mt_gpufreq_get_leakage_mw(void)
 {
@@ -1604,7 +1614,7 @@ void __mt_gpufreq_update_aging(bool apply_aging_setting)
 				g_opp_table[i].gpufreq_volt -= 1875;
 			else if (i >= 10 && i <= (aging_margin_idx - 1))
 				g_opp_table[i].gpufreq_volt -= 1250;
-			else if (i >= aging_margin_idx && i <= 31)
+			else if (i >= aging_margin_idx && i <= 39)
 				g_opp_table[i].gpufreq_volt -= 625;
 
 	g_opp_table[i].gpufreq_vsram =
@@ -1621,7 +1631,7 @@ void __mt_gpufreq_update_aging(bool apply_aging_setting)
 				g_opp_table[i].gpufreq_volt += 1875;
 			else if (i >= 10 && i <= (aging_margin_idx - 1))
 				g_opp_table[i].gpufreq_volt += 1250;
-			else if (i >= aging_margin_idx && i <= 31)
+			else if (i >= aging_margin_idx && i <= 39)
 				g_opp_table[i].gpufreq_volt += 625;
 
 	g_opp_table[i].gpufreq_vsram =
@@ -2588,7 +2598,8 @@ static void __mt_gpufreq_setup_opp_table(struct g_opp_table_info *freqs, int num
 
 	/* setup segment max/min opp_idx */
 	g_segment_max_opp_idx = 0;
-	g_segment_min_opp_idx = 31;
+	g_segment_min_opp_idx = 39;
+
 
 	g_max_opp_idx_num = num;
 	g_max_limited_idx = g_segment_max_opp_idx;
diff --git a/drivers/misc/mediatek/base/power/mt6768/mtk_gpufreq_core.h b/drivers/misc/mediatek/base/power/mt6768/mtk_gpufreq_core.h
index bea07bb72..d1b7e175a 100644
--- a/drivers/misc/mediatek/base/power/mt6768/mtk_gpufreq_core.h
+++ b/drivers/misc/mediatek/base/power/mt6768/mtk_gpufreq_core.h
@@ -18,83 +18,100 @@
  * MT6768/MT6767 : GPU DVFS OPP table Setting
  **************************************************/
 #define SEG_GPU_DVFS_FREQ0			(1200000)	/* KHz */
-#define SEG_GPU_DVFS_FREQ1			(1200000)	/* KHz */
-#define SEG_GPU_DVFS_FREQ2			(1200000)	/* KHz */
-#define SEG_GPU_DVFS_FREQ3			(925000)	/* KHz */
-#define SEG_GPU_DVFS_FREQ4			(900000)	/* KHz */
-#define SEG_GPU_DVFS_FREQ5			(875000)	/* KHz */
-#define SEG_GPU_DVFS_FREQ6			(850000)	/* KHz */
-#define SEG_GPU_DVFS_FREQ7			(823000)	/* KHz */
-#define SEG_GPU_DVFS_FREQ8			(796000)	/* KHz */
-#define SEG_GPU_DVFS_FREQ9			(769000)	/* KHz */
-#define SEG_GPU_DVFS_FREQ10			(743000)	/* KHz */
-#define SEG_GPU_DVFS_FREQ11			(716000)	/* KHz */
-#define SEG_GPU_DVFS_FREQ12			(690000)	/* KHz */
-#define SEG_GPU_DVFS_FREQ13			(663000)	/* KHz */
-#define SEG_GPU_DVFS_FREQ14			(637000)	/* KHz */
-#define SEG_GPU_DVFS_FREQ15			(611000)	/* KHz */
-#define SEG_GPU_DVFS_FREQ16			(586000)	/* KHz */
-#define SEG_GPU_DVFS_FREQ17			(560000)	/* KHz */
-#define SEG_GPU_DVFS_FREQ18			(535000)	/* KHz */
-#define SEG_GPU_DVFS_FREQ19			(509000)	/* KHz */
-#define SEG_GPU_DVFS_FREQ20			(484000)	/* KHz */
-#define SEG_GPU_DVFS_FREQ21			(467000)	/* KHz */
-#define SEG_GPU_DVFS_FREQ22			(450000)	/* KHz */
-#define SEG_GPU_DVFS_FREQ23			(434000)	/* KHz */
-#define SEG_GPU_DVFS_FREQ24			(417000)	/* KHz */
-#define SEG_GPU_DVFS_FREQ25			(400000)	/* KHz */
-#define SEG_GPU_DVFS_FREQ26			(383000)	/* KHz */
-#define SEG_GPU_DVFS_FREQ27			(366000)	/* KHz */
-#define SEG_GPU_DVFS_FREQ28			(349000)	/* KHz */
-#define SEG_GPU_DVFS_FREQ29			(349000)	/* KHz */
-#define SEG_GPU_DVFS_FREQ30			(349000)	/* KHz */
-#define SEG_GPU_DVFS_FREQ31			(349000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ1			(1175000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ2			(1150000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ3			(1125000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ4			(1100000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ5			(1075000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ6			(1050000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ7			(1025000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ8			(1000000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ9			(975000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ10			(950000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ11			(925000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ12			(900000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ13			(875000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ14			(850000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ15			(823000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ16			(796000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ17			(769000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ18			(743000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ19			(716000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ20			(690000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ21			(663000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ22			(637000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ23			(611000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ24			(586000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ25			(560000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ26			(535000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ27			(509000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ28			(484000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ29			(467000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ30			(450000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ31			(434000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ32			(417000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ33			(400000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ34			(383000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ35			(366000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ36			(349000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ37			(332000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ38			(315000)	/* KHz */
+#define SEG_GPU_DVFS_FREQ39			(299000)	/* KHz */
 
-#define SEG_GPU_DVFS_VOLT0		(105000)		/* mV x 100 */
-#define SEG_GPU_DVFS_VOLT1		(100000)		/* mV x 100 */
-#define SEG_GPU_DVFS_VOLT2		(95000)		/* mV x 100 */
-#define SEG_GPU_DVFS_VOLT3		(87500)		/* mV x 100 */
-#define SEG_GPU_DVFS_VOLT4		(85000)		/* mV x 100 */
-#define SEG_GPU_DVFS_VOLT5		(82500)		/* mV x 100 */
-#define SEG_GPU_DVFS_VOLT6		(80000)		/* mV x 100 */
-#define SEG_GPU_DVFS_VOLT7		(79375)		/* mV x 100 */
-#define SEG_GPU_DVFS_VOLT8		(78125)		/* mV x 100 */
-#define SEG_GPU_DVFS_VOLT9		(76875)		/* mV x 100 */
-#define SEG_GPU_DVFS_VOLT10		(75625)		/* mV x 100 */
-#define SEG_GPU_DVFS_VOLT11		(75000)		/* mV x 100 */
-#define SEG_GPU_DVFS_VOLT12		(73750)		/* mV x 100 */
-#define SEG_GPU_DVFS_VOLT13		(72500)		/* mV x 100 */
-#define SEG_GPU_DVFS_VOLT14		(71250)		/* mV x 100 */
-#define SEG_GPU_DVFS_VOLT15		(70625)		/* mV x 100 */
-#define SEG_GPU_DVFS_VOLT16		(70000)		/* mV x 100 */
-#define SEG_GPU_DVFS_VOLT17		(69375)		/* mV x 100 */
-#define SEG_GPU_DVFS_VOLT18		(68750)		/* mV x 100 */
-#define SEG_GPU_DVFS_VOLT19		(68125)		/* mV x 100 */
-#define SEG_GPU_DVFS_VOLT20		(66875)		/* mV x 100 */
-#define SEG_GPU_DVFS_VOLT21		(66875)		/* mV x 100 */
-#define SEG_GPU_DVFS_VOLT22		(66250)		/* mV x 100 */
-#define SEG_GPU_DVFS_VOLT23		(65625)		/* mV x 100 */
-#define SEG_GPU_DVFS_VOLT24		(65000)		/* mV x 100 */
-#define SEG_GPU_DVFS_VOLT25		(64375)		/* mV x 100 */
-#define SEG_GPU_DVFS_VOLT26		(64375)		/* mV x 100 */
-#define SEG_GPU_DVFS_VOLT27		(63750)		/* mV x 100 */
-#define SEG_GPU_DVFS_VOLT28		(63125)		/* mV x 100 */
-#define SEG_GPU_DVFS_VOLT29		(62500)		/* mV x 100 */
-#define SEG_GPU_DVFS_VOLT30		(61875)		/* mV x 100 */
-#define SEG_GPU_DVFS_VOLT31		(61250)		/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT0		(115000)	/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT1		(112500)	/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT2		(110000)	/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT3		(107500)	/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT4		(105000)	/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT5		(102500)	/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT6		(100000)	/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT7		(97500)		/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT8		(95000)		/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT9		(92500)		/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT10		(90000)		/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT11		(87500)		/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT12		(85000)		/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT13		(82500)		/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT14		(80000)		/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT15		(79375)		/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT16		(78125)		/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT17		(76875)		/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT18		(75625)		/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT19		(75000)		/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT20		(73750)		/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT21		(72500)		/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT22		(71250)		/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT23		(70625)		/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT24		(70000)		/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT25		(69375)		/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT26		(68750)		/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT27		(68125)		/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT28		(66875)		/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT29		(66875)		/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT30		(66250)		/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT31		(65625)		/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT32		(65000)		/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT33		(64375)		/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT34		(64375)		/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT35		(63750)		/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT36		(63125)		/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT37		(62500)		/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT38		(61875)		/* mV x 100 */
+#define SEG_GPU_DVFS_VOLT39		(61250)		/* mV x 100 */
 
-#define SEG_GPU_DVFS_VSRAM0		(110000)	/* mV x 100 */
+#define SEG_GPU_DVFS_VSRAM0		(115000)	/* mV x 100 */
 #define SEG_GPU_DVFS_VSRAM1		(105000)	/* mV x 100 */
-#define SEG_GPU_DVFS_VSRAM2		(100000)	/* mV x 100 */
-#define SEG_GPU_DVFS_VSRAM3		(97500)		/* mV x 100 */
-#define SEG_GPU_DVFS_VSRAM4		(95000)		/* mV x 100 */
-#define SEG_GPU_DVFS_VSRAM5		(92500)		/* mV x 100 */
-#define SEG_GPU_DVFS_VSRAM6		(90000)		/* mV x 100 */
-#define SEG_GPU_DVFS_VSRAM7		(89375)		/* mV x 100 */
-#define SEG_GPU_DVFS_VSRAM8		(88125)		/* mV x 100 */
-#define SEG_GPU_DVFS_VSRAM9		(86875)		/* mV x 100 */
-#define SEG_GPU_DVFS_VSRAM10	(85625)		/* mV x 100 */
-#define SEG_GPU_DVFS_VSRAM11	(85000)		/* mV x 100 */
+#define SEG_GPU_DVFS_VSRAM2		(102500)	/* mV x 100 */
+#define SEG_GPU_DVFS_VSRAM3		(100000)	/* mV x 100 */
+#define SEG_GPU_DVFS_VSRAM4		(97500)		/* mV x 100 */
+#define SEG_GPU_DVFS_VSRAM5		(95000)		/* mV x 100 */
+#define SEG_GPU_DVFS_VSRAM6		(92500)		/* mV x 100 */
+#define SEG_GPU_DVFS_VSRAM7		(90000)		/* mV x 100 */
+#define SEG_GPU_DVFS_VSRAM8		(89375)		/* mV x 100 */
+#define SEG_GPU_DVFS_VSRAM9		(88125)		/* mV x 100 */
+#define SEG_GPU_DVFS_VSRAM10		(86875)		/* mV x 100 */
+#define SEG_GPU_DVFS_VSRAM11	(85625)		/* mV x 100 */
+#define SEG_GPU_DVFS_VSRAM12	(85000)		/* mV x 100 */
 
 #define FIXED_VSRAM_VOLT			(85000)		/* mV x 100 */
 #define FIXED_VSRAM_VOLT_THSRESHOLD	(75000)		/* mV x 100 */
@@ -107,7 +124,7 @@
 #define DELAY_FACTOR		(625)
 #define BUCK_DIFF_MAX		(25000)		/* mV x 100 */
 #define BUCK_DIFF_MIN		(10000)		/* mV x 100 */
-#define NUM_OF_OPP_IDX		(32)
+#define NUM_OF_OPP_IDX		(40)
 
 /**************************************************
  * efuse Setting
@@ -296,4 +313,3 @@ extern bool mtk_get_gpu_loading(unsigned int *pLoading);
 extern unsigned int mt_get_ckgen_freq(unsigned int);
 
 #endif /* _MT_GPUFREQ_CORE_H_ */
-
